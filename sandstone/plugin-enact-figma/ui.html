<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Generate</title>
</head>

<body style="display: flex; flex-direction: column;">

<div id="plugin-actions">
	<div>
		<button id="write-file-button">Generate</button>
		<button id="save-dir">Save to directory</button>
		<button id="open-app">Open Web App</button>
	</div>
	<pre id="code" style="padding-top: 20px;"></pre>
</div>

<div id="enact-app" style="display: none;">
	<button id="back">Back</button>
	<iframe style="width: 950px; height: 550px" src="http://localhost:8080" title="Web App"></iframe>
</div>

<script>

	document.getElementById('write-file-button').addEventListener('click', () => {
		parent.postMessage({ pluginMessage: { type: 'create' } }, '*');
	});

	document.getElementById('save-dir').addEventListener('click', async () => {
		const data = document.getElementById("code").innerText
		if (!!data) {
			const blob = new Blob([data], { type: 'text/javascript' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'File.js';
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);
		} else {
			alert("Generate the code first!")
		}
	});

	document.getElementById('open-app').addEventListener('click', async () => {
		const pluginElement = document.getElementById('plugin-actions');
		const enactApp = document.getElementById('enact-app');
		pluginElement.style.display = 'none';
		enactApp.style.display = 'block';
	});

	document.getElementById('back').addEventListener('click', async () => {
		const pluginElement = document.getElementById('plugin-actions');
		const enactApp = document.getElementById('enact-app');
		pluginElement.style.display = 'block';
		enactApp.style.display = 'none';
	});

	window.onmessage = (event) => {
		const msg = event.data.pluginMessage;

		if (msg.type === 'show-code') {
			const div = document.getElementById("code");
			div.innerText = msg.data;
		}
	}
</script>
</body>

</html>
